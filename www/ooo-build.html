<!doctype html PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html lang="en">
  <head>
    <meta lang="en" http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>About ooo-build</title>
  </head>

  <body>
    <h1>About ooo-build</h1>
    
    <h2 id="section-0">0. Contents</h2>
    <ul>
       <li><a href="#section-1">1. Why ooo-build</a></li>
       <li><a href="#section-2">2. Getting involved</a></li>
<!-- FIXME - need structural docs on ooo-build and how it works -->
       <li><a href="#section-3">3. Downsides</a></li>
       <li><a href="#section-4">4. Areas for improvement</a></li>
    </ul>

    <h2 id="section-1">1. Why ooo-build</h2>
    <p>
      There are a number of reasons for the existence of ooo-build:
      <ul>
        <li>1. CVS doesn't scale
	<li>2. OO.o process is too slow
	<li>3. build / package infrastructure
	<li>4. lack of interest in up-streaming
      </ul>
    </p>
    <h3 id="section-1.1">1.1 CVS doesn't scale</h3>
    <p>	
      A simple cvs tag of the whole of the OO.o tree can take several
      hours to complete; thus if you want to have a very extensive patch
      set against OO.o you cannot work at a sensible speed. All cvs
      operations, branching, merging, re-synching even simple updating,
      take a very considerable time. Working from a separate base tar.gz
      and a flexible patching system allows the maintenance of a branch
      very much more easily.
    </p>
    <h3 id="section-1.2">1.2 OO.o process is too slow</h3>
    <p>	
      Why do we have to have a branch, and a large patch set at all ?
      why can't we just work directly from OO.o CVS.
    </p>
    <p>
      There are several answers here: primarily that CVS commits are
      extremely restricted, the approval process from IssueZilla submit
      to eventual CWS commit, to CWS merge takes a matter of weeks; this
      is no way to create excitement, and provide fast problem fixes.
      Furthermore, there are contraints to merging to a stable branch
      that disallow many changes. Large changes cannot happen eg. (a
      base vtable change, new icons) since Sun have to ship binary 
      bug fix updates - which are required to be reasonably small
      (ie. not all of OO.o again).
    </p>
    <p>
      Furthermore, Sun will only accept patches after receipt of a
      posted / FAXed, signed JCA. While we feel the JCA is a vital
      to OO.o and mandate it's use for ooo-build commits, we are
      happy to prune this postal / processing / CVS account bug ticket
      creation / CVS account bug ticket assignment to collab.net / CVS
      account creation / commit latency. With assurance of an in-flight
      JCA - we can create a CVS account quickly and get you working with
      a handful of hours.
    </p>
    <p>
      Sun has a need for a highly stable / buildable branch from which
      they can make releases. There are two approaches to get a
      stable/buildable branch:
      <ul>
        <li>A. Mandate stringent testing, code review, debug builds, and
	highly restricted commit access.
	<li>B. Encourage a culture of carefulness, and highly unresticted
	commit access.
      </ul>
      While B. results in frequent, temporary breakage, this is soon fixed,
      and life is fast, smooth and happy. The existing situation: A. leads
      to communal frustration / strangulation - however it does provide a
      stable branch at most times.
    </p>
    <p>
      Of course - <i>hopefully</i> at some time in the future problem <a
      href="section-1.1">1.1</a> may get fixed - at which point keeping a
      branch in OO.o cvs that allowed sensible communal development, while
      allowing merge-backs to stable would be feasible.
    </p>
    <h3 id="section-1.3">1.3 build / package infrastructure</h3>
    <p>
      The core OO.o build process is not easy to use, and the packaging
      process on Unix is anachronistic, and inflicts incredible pain on
      sysadmins and users. Thus, this has to be worked around externally
      to OO.o. This is a substantial amount of work - unfortunately, it
      seems the re-creation of a Unix build is also a pending internal
      task - hopefully this will not result in an even bigger mess of
      alternative packaging schemes.
    </p>
    <h3 id="section-1.4">1.4 flexible staging ground for patches in
    progress</h3> <p>
      We have introduced a way to select a subset of patches to apply to
      a particular build.  For example, Ximian uses a set of patches to
      use CUPS as the printing system, which Debian, as a more general
      distribution cannot do, but both packages use the fontconfig support.
    </p>
    <p>
      It also gives the patches a chance to be tested by a wider user 
      community while they await integration into the main version.
    </p>
    <h3 id="section-1.5">1.5 lack of interest in up-streaming</h3>
    <p>
      There have been for many years, very many patches against OO.o to
      do all manner of useful things. Many of these have been submitted
      under the JCA. The pace of adoption of these changes is really
      depressingly slow; and the level of engagement with external
      contributors poor. In some cases whole chunks of functionality
      have been re-written internally without reference to, acknowledgement
      of, or discussion with the original author - this phenomenon
      continues apace.
    </p>

    <h2 id="section-2">2. Getting changes in</h2>

    <h3 id="section-2.1">2.1 Communication</h3>

    <p>
      Without communication it's impossible to co-ordinate what is being
      done. It's also impossible to have any confidence that your patch
      will be useful / nicely designed. To try and overcome this, and to
      encourage each other - we hang out on channel #OpenOffice.org on
      irc.freenode.net, you'll soon get to know the team. See also
      <a href="name-account.html">here</a> to see who is whom.
    </p>

    <h3 id="section-2.2">2.2 First time setup</h3>
    <p>
      So; since the source tar.gz is a snapshot taken from a random user's
      account; you need to switch this to using the anoncvs root; to do this
      cd build/OOO_1_1_0 (eg.) and run <pre>bin/re-root .</pre> - this will
      switch the CVS/Root directories to use the anon-cvs server.
    </p>
    <p>
      Since we are interested in diffs from the toplevel - which has no CVS
      directory; we also need to do: <pre>export CVSROOT=`cat moz/CVS/Root`</pre>
      NB. '`' is a back-tick.
    </p>
    <p>
        It is of course crucial that you or your company have signed and posted
	the JCA; see <a href="http://www.openoffice.org/contributing">here</a>.
    </p>

    <h3 id="section-2.3">Generating the patch</h3>
    <p>
      Having done this we can make a patch; taking the sample toolbar change
      from <a href="hackers-guide.html#section-5.0">here</a> we would do this:
      <pre>
      cvs -z3 diff -u vcl/source/window/toolbox.cxx | tee ../../patches/OOO_1_1/gui-toolbox-hack.diff
      </pre>
      <p>
        <strong>NB.</strong> to append a patch to an existing diff use <pre>tee -a</pre>
      </p>
      <p>
        <strong>NB.</strong> to avoid having to type -z3 &amp; -u grab <a
	href="http://primates.ximian.com/~michael/.cvsrc"</a> and put it in ~.
      </p>
    </p>

    <h3 id="section-2.4">2.4 Adding to the apply set</h3>
    <p>
	Before committing the patch, we need to submit it to <a
	href="http://www.openoffice.org">IssueZilla</a> (IZ) - this is about the most
	painful bit: re-login (again), hit <i>File an Issue</i>, commit the issue,
	and attach the patch - remember the IZ number.
    </p>
    <p>
      Having created the patch, you then need to edit the relevant apply set; eg.
      <pre>patches/OOO_1_1_0/apply</pre> and add the patch to a relevant section,
      along with a comment line that describes it - and references the IZ number.
      eg.
<pre># this adds a nasty hack to the toolbar - #32179
gui-toolbox-hack.diff
</pre>
    </p>

    <h3 id="section-2.4">2.4 Committing the new patch to openoffice</h3>
    <h4 id="section-2.4.1">2.4.1 your first commit to openoffice</h4>
    <p>
      <ul>
	<li>Create a perl crypted password:
	    <pre>perl -e "print ':'.crypt('mypassword', 'zt').':';"</pre>
	    'zt' should be 2 random chars, and 'mypassword' should be a strong
	    password.
	<li>E-mail this crypted password with your full name, and contact E-mail
	    address to <a href="mailto:michael@ximian.com">michael@ximian.com</a>
	    and/or <a href="halls@debian.org">halls@debian.org</a>.
	<li>If you overlap in European time poke michael / haggai on IRC.
      </ul>
    </p>
    <p>
    <h4 id="section-2.4.2">2.4.2 how to commit</h4>
    <p>
      First ensure you have a ChangeLog entry in openoffice/ChangeLog, this
      should look like:
      <pre>
2003-10-23  FirstName LastName  <EMail@MyCompany.com>

    * patches/OOO_1_1/gui-toolbox-hack.diff,
    * patches/OOO_1_1_0/apply: add a nasty hack for toolbars.
</pre>
      Now, from the toplevel directory run <pre>cvs commit</pre>, use your
ChangeLog text for the CVS commit message.
    </p>

    <h2 id="section-3">3. Downsides</h2>
    <p>
      Of course this has a number of obvious down-sides for you as a
      contributor:
      <ul>
        <li>Working outside CVS makes up-streaming harder, and commits
	somewhat more painful.
	<li>You get no immeditate 'official' recognition; no-matter how large
	your contribution to OO.o you don't exist in the eyes of the artificial
	OO.o <i>community</i> as ooo-build is not an 'official' project;
	however - we value you more.
      </ul>
    </p>
   
    <h2 id="section-4">4. Areas for improvement</h2>
    <p>
      Obviously the existing situation is highly sub-optimal, here are some
      possible improvements beyond our control that could be made:
      <ul>
	<li>1. accelerating CVS performance - this is a hard task, possible
	<a href="http://subversion.tigris.org">subversion</a> may solve this
	in due course. A more feasible alternative would to devote resources
	to committing to merging CWS' targetting stable to a parallel playground
	branch in OO.o CVS as well [ thus avoiding painful community merging ].

        <li>2. accelerating OO.o CVS account creation, binning ACLs and
	hugely increasing access (&amp; trust); thus we can get more people
	involved more quickly without demoralisation.

	<li>3. aggressive interest in working with external people, and merging
	their patches; this involves at a minumum:
	  <ul>
	    <li>Rapid response to design queries.
	    <li>Research and response to other OO.o development streams and
	    their patch sets; discussion of requirements for merging.
	    <li>Clear, interactive, casual access to relevant developers
	    to discuss design before larger changes are attempted.
	  </ul>

	<li>4. recognising the needs of Unix packagers to have substantial
	wrappers / work around OO.o, and allowing them to integrate all of
	it, leaving no need for separate branches.
      </ul>
    </p>

  </body>
</html>
